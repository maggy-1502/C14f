<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carta de San Valentín</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family:'Segoe UI',sans-serif;
    background:#ffc0cb;
    color:#fff;
    overflow:hidden;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}

/* Pantallas */
.pantalla{
    position:absolute;
    width:100%;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    transition:opacity 1s;
}
.oculto{display:none;}

/* Botón */
button{
    padding:10px 20px;
    font-size:1.2rem;
    background-color:#ff6b81;
    border:none;
    border-radius:10px;
    cursor:pointer;
    color:white;
    margin-top:20px;
    transition:transform 0.2s;
}
button:hover{transform:scale(1.1);}

/* Sobre 3D */
.sobre{
    width:200px;
    height:150px;
    background:#ff6b81;
    position:relative;
    border-radius:10px;
    display:flex;
    justify-content:center;
    align-items:center;
    transform-style:preserve-3d;
    transition:transform 1s, opacity 1s;
    cursor:pointer;
    pointer-events:none; /* activaremos después */
    opacity:0;
}
.sobre.visible{opacity:1; pointer-events:auto;}
.solapa{
    position:absolute;
    top:0;
    width:200px;
    height:75px;
    background:#ff4b6e;
    border-top-left-radius:10px;
    border-top-right-radius:10px;
    transform-origin:top;
    transform:rotateX(0deg);
    transition:transform 2s ease-in-out;
}
.sobre.abierto .solapa{transform:rotateX(-180deg);}

/* Carta */
.carta{
    width:300px;
    height:400px;
    background:white;
    color:black;
    font-style:italic;
    font-size:1.2rem;
    padding:20px;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%) translateY(30px);
    opacity:0;
    border-radius:15px;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    overflow:hidden;
    transition:opacity 1.5s ease, transform 1.5s ease;
    pointer-events:none;
}
.carta.mostrada{opacity:1; transform:translate(-50%, -50%) translateY(0);}

/* Corazón final */
#corazon-final{
    font-size:8rem;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    animation:latido 1.2s infinite ease-in-out;
    animation-play-state: paused;
    z-index:10;
    display:none;
}
@keyframes latido{
    0%{transform:translate(-50%, -50%) scale(1);}
    25%{transform:translate(-50%, -50%) scale(1.15);}
    50%{transform:translate(-50%, -50%) scale(1);}
    75%{transform:translate(-50%, -50%) scale(1.25);}
    100%{transform:translate(-50%, -50%) scale(1);}
}

/* Lluvia de corazones */
.corazon-flotante{
    position:absolute;
    font-size:1.5rem;
    animation:flotar 5s linear infinite;
}
@keyframes flotar{
    0%{transform:translateY(100vh) rotate(0deg);opacity:1;}
    100%{transform:translateY(-10vh) rotate(360deg);opacity:0;}
}

/* Modo noche */
body.noche{background:#2c003e;color:white;}
body.noche .sobre{background:#ff4b81;}
body.noche .solapa{background:#ff1f6e;}

/* Estrellas */
.estrella{
    position:absolute;
    width:5px;
    height:5px;
    background:white;
    border-radius:50%;
    opacity:0.8;
    animation: titilar 2s infinite alternate;
}
@keyframes titilar{
    0%{opacity:0.2;}
    50%{opacity:1;}
    100%{opacity:0.2;}
}
</style>
</head>
<body>

<!-- Pantalla inicial -->
<div id="pantalla-inicial" class="pantalla">
<h1>Feliz San Valentín</h1>
<button id="btn-siguiente">Siguiente</button>
</div>

<!-- Sobre y carta -->
<div id="pantalla-carta" class="pantalla oculto">
    <div id="sobre" class="sobre"><div class="solapa"></div></div>
    <div id="carta" class="carta"></div>
</div>

<!-- Corazón final -->
<div id="corazon-final">❤️</div>

<!-- Música -->
<audio id="musica" src="es-verdad-video-oficial.mp3"></audio>

<script>
const pantallaInicial=document.getElementById('pantalla-inicial');
const pantallaCarta=document.getElementById('pantalla-carta');
const btnSiguiente=document.getElementById('btn-siguiente');
const sobre=document.getElementById('sobre');
const carta=document.getElementById('carta');
const musica=document.getElementById('musica');
musica.volume = 0.6;
const corazonFinal=document.getElementById('corazon-final');
const body=document.body;

const mensaje=`Feliz San Valentín, muchas gracias por estar.
Es el primer San Valentín que paso con alguien jaja, y la verdad me hace muy feliz que seas tú. 
No soy muy buena escribiendo ni expresando lo que siento, pero quería intentar decirte que me importas muchísimo. 
Este es el primer regalo que te hago, de muchos que pienso hacerte, así que vete acostumbrando jaja.
Gracias por hacer mis días más lindos y por estar conmigo.
Te quiero mucho.`;

// Modo noche
function detectarModoNoche(){
    const hora = new Date().getHours();
    if (hora >= 18 || hora < 6) {
        body.classList.add('noche');
    }
}
detectarModoNoche();

// Botón siguiente
btnSiguiente.addEventListener('click',()=>{
    pantallaInicial.classList.add('oculto');
    pantallaCarta.classList.remove('oculto');
    // Aparece el sobre y se puede clickear
    sobre.classList.add('visible');
});

// Secuencia sobre-carta
sobre.addEventListener('click',()=>{
    sobre.classList.add('abierto');
    musica.play();

    // Carta aparece y empieza a escribirse
    setTimeout(()=>{
        carta.classList.add('mostrada');
        escribirCarta();
    },1000);
});

// Máquina de escribir
function escribirCarta(){
    let i = 0;
    carta.innerHTML = '';

    const intervalo = setInterval(()=>{
        carta.innerHTML += mensaje.charAt(i);
        i++;
        carta.scrollTop = carta.scrollHeight;

        if(i === mensaje.length){
            clearInterval(intervalo);

            // pequeña pausa al terminar de escribir
            setTimeout(() => {

                // pausa emocional con la carta completa
                setTimeout(() => {

                    carta.classList.remove('mostrada');
                    sobre.classList.remove('abierto');

                    // Esperamos a que termine la animación (1.5s)
                    setTimeout(() => {

                        pantallaCarta.classList.add('oculto');
                        pantallaCarta.style.pointerEvents = 'none';

                        corazonFinal.style.display = 'block';
                        corazonFinal.style.animationPlayState = 'running';
                        corazonFinal.style.animationDuration = '1.3s';

                        crearLluviaCorazones();

                        if(body.classList.contains('noche')){
                            crearCorazonEstrellas();
                        }

                    }, 1500);

                }, 3000);

            }, 500);
        }
    }, 70);
}
// Lluvia de corazones
function crearLluviaCorazones(){
    setInterval(()=>{
        const heart=document.createElement('div');
        heart.classList.add('corazon-flotante');
        heart.style.left=Math.random()*window.innerWidth+'px';
        heart.style.color='#ff4b81';
        heart.innerText='❤️';
        document.body.appendChild(heart);
        setTimeout(()=>heart.remove(),5000);
    },300);
}

// Corazón de estrellas al final
function crearCorazonEstrellas(){
    const centerX=window.innerWidth/2;
    const centerY=window.innerHeight/2;
    const scale=12;
    for(let i=0;i<200;i++){
        const t=i/200*Math.PI*2;
        const x=scale*16*Math.pow(Math.sin(t),3);
        const y=-scale*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
        const star=document.createElement('div');
        star.classList.add('estrella');
        star.style.left=(centerX+x)+'px';
        star.style.top=(centerY+y)+'px';
        star.style.width = (Math.random()*3 + 2) + 'px';
        star.style.height = (Math.random()*3 + 2) + 'px';
        star.style.animationDuration=(Math.random()*2+1)+'s';
        body.appendChild(star);
    }
}
//Sincronizar latido con la música
musica.addEventListener('timeupdate', () => {
    const t = musica.currentTime;

    if (!corazonFinal.style.display || corazonFinal.style.display === 'none') return;

    // Inicio del final: latido suave
    if (t < 60) {
        corazonFinal.style.animationDuration = '1.4s';
    }
    // Parte emocional media
    else if (t >= 60 && t < 90) {
        corazonFinal.style.animationDuration = '1.1s';
    }
    // Final más intenso
    else {
        corazonFinal.style.animationDuration = '0.9s';
    }
});
</script>
</body>
</html>
